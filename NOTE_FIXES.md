# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã "–≥—É–¥–∏—Ç –Ω–∞ –æ–¥–Ω–æ–π —á–∞—Å—Ç–æ—Ç–µ"

## –ü—Ä–æ–±–ª–µ–º–∞
–°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —á–∞—Å—Ç–æ—Ç—É –∏ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–ª—Å—è –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –Ω–æ—Ç–∞–º–∏.

## –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤**
- `mixVoices()` –±—Ä–∞–ª —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π –≥–æ–ª–æ—Å
- –ù–æ–≤—ã–µ –Ω–æ—Ç—ã –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å, –µ—Å–ª–∏ —É–∂–µ –±—ã–ª –∞–∫—Ç–∏–≤–Ω—ã–π –≥–æ–ª–æ—Å
- –°—Ç–∞—Ä—ã–µ –≥–æ–ª–æ—Å–∞ –Ω–µ –æ—Ç–∫–ª—é—á–∞–ª–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –Ω–æ—Ç**
- –ù–æ—Ç—ã –Ω–µ –æ—Ç–∫–ª—é—á–∞–ª–∏—Å—å —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è
- –ì–æ–ª–æ—Å–∞ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–ª–∏—Å—å –∏ –º–µ—à–∞–ª–∏ –Ω–æ–≤—ã–º

### 3. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –±–∞—Ä–∞–±–∞–Ω–∞–º–∏ –∏ –Ω–æ—Ç–∞–º–∏**
- –ë–∞—Ä–∞–±–∞–Ω–Ω—ã–µ –∑–≤—É–∫–∏ –º–æ–≥–ª–∏ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å –Ω–æ—Ç—ã
- –ù–µ –±—ã–ª–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–≤—É–∫–æ–≤

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–£–ª—É—á—à–µ–Ω–æ –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤**
```cpp
// –¢–µ–ø–µ—Ä—å –±–µ—Ä–µ–º —Å–∞–º—ã–π –Ω–æ–≤—ã–π –≥–æ–ª–æ—Å –≤–º–µ—Å—Ç–æ –ø–µ—Ä–≤–æ–≥–æ
if (voices[i].startTime >= newestVoiceTime) {
    newestVoiceTime = voices[i].startTime;
    newestVoiceIndex = i;
    mixedFreq = voices[i].frequency;
    mixedVolume = volume;
}
```

### 2. **–î–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –≥–æ–ª–æ—Å–æ–≤**
```cpp
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≥–æ–ª–æ—Å–∞ (—Å—Ç–∞—Ä—à–µ 2 —Å–µ–∫—É–Ω–¥)
for (uint8_t i = 0; i < MAX_VOICES; i++) {
    if (voices[i].active && (currentTime - voices[i].startTime) > 2000) {
        voices[i].active = false;
    }
}
```

### 3. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ä–∞–±–∞–Ω–Ω—ã—Ö –∑–≤—É–∫–æ–≤**
```cpp
// –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –≥–æ–ª–æ—Å–∞ –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–Ω–æ–≥–æ –∑–≤—É–∫–∞
for (uint8_t i = 0; i < MAX_VOICES; i++) {
    if (voices[i].active) {
        voices[i].active = false;
    }
}
```

### 4. **–î–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ—Ç**
```cpp
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ—Ç—É —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è
if (currentTime - lastNoteTime > 100) { // 100–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞
    synth.noteOff(trackIndex, midiNote);
    lastNoteTime = currentTime;
}
```

### 5. **–£–ª—É—á—à–µ–Ω –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥**
- –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### ‚úÖ **–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:**
1. **–†–∞–∑–Ω—ã–µ –Ω–æ—Ç—ã** - –∫–∞–∂–¥–∞—è –Ω–æ–≤–∞—è –Ω–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ** - —Å—Ç–∞—Ä—ã–µ –Ω–æ—Ç—ã –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è
3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–æ–≤—ã—Ö –∑–≤—É–∫–æ–≤** - –Ω–æ–≤—ã–µ –Ω–æ—Ç—ã –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ —Å—Ç–∞—Ä—ã–º–∏
4. **–ë–∞—Ä–∞–±–∞–Ω–Ω—ã–µ –∑–≤—É–∫–∏** - –Ω–µ –º–µ—à–∞—é—Ç –Ω–æ—Ç–∞–º
5. **–û—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–º–µ–Ω—É –Ω–æ—Ç

### üìä **–û—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
```
MIDI: noteOn ch=0, note=60, freq=262, vel=64, voice=0
mixVoices: 1 active voices, using newest: freq=262, vol=64
MIDI: noteOn ch=0, note=64, freq=330, vel=64, voice=1
mixVoices: 2 active voices, using newest: freq=330, vol=64
Auto-stopping old voice 0 (age=2001 ms)
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç**
```bash
python test_notes.py
```

### 2. **–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ–∫–≤–µ–Ω—Å–æ—Ä (`p` –∫–æ–º–∞–Ω–¥–∞)
2. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —á–∞—Å—Ç–æ—Ç–∞ –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –Ω–æ—Ç–∞—Ö
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –≥–æ–ª–æ—Å–∞ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã**
1. –ù–∞–∂–º–∏—Ç–µ —Ä–∞–∑–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–∞–∂–¥–∞—è –∫–ª–∞–≤–∏—à–∞ –¥–∞–µ—Ç —Ä–∞–∑–Ω—É—é —á–∞—Å—Ç–æ—Ç—É
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–æ—Ç—ã –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–ª—è –ª—É—á—à–µ–π —Ä–∞–±–æ—Ç—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
1. **–ù–∞—Å—Ç–æ—è—â–µ–µ –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤–º–µ—Å—Ç–æ –≤—ã–±–æ—Ä–∞ –æ–¥–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞
2. **ADSR –æ–≥–∏–±–∞—é—â–∏–µ** - –¥–ª—è –±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∑–≤—É–∫–∞
3. **–§–∏–ª—å—Ç—Ä—ã** - –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
4. **–≠—Ñ—Ñ–µ–∫—Ç—ã** - —Ä–µ–≤–µ—Ä–±, —Ö–æ—Ä—É—Å
5. **–ü–æ–ª–∏—Ñ–æ–Ω–∏—è** - –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ—Ç

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ "–≥—É–¥–∏—Ç –Ω–∞ –æ–¥–Ω–æ–π —á–∞—Å—Ç–æ—Ç–µ":

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥** - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ –Ω–æ—Ç
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∞—Å—Ç–æ—Ç—ã** - –≤ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–º –≤—ã–≤–æ–¥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ PWM** - —á–∞—Å—Ç–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –º–µ–Ω—è—Ç—å—Å—è –≤ `updatePWM()`
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–¥–∞—á–∏** - `SynthesizerTask` –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å `update()`

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- **–ù–µ—Ç –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ UART –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- **–ß–∞—Å—Ç–æ—Ç–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `mixVoices()`
- **–ù–æ—Ç—ã –Ω–µ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
- **–ë–∞—Ä–∞–±–∞–Ω—ã –º–µ—à–∞—é—Ç** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–≤—É–∫–æ–≤
